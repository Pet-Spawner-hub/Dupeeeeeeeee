local player = game.Players.LocalPlayer
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "DuplicatePetUI"

-- Function to create buttons
local function makeButton(name, text, pos, color)
    local btn = Instance.new("TextButton", gui)
    btn.Name = name
    btn.Size = UDim2.new(0, 160, 0, 50)
    btn.Position = pos
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 22
    btn.Text = text
    btn.Draggable = true
    btn.Active = true
    btn.Selectable = true
    return btn
end

-- Buttons
local dupeBtn = makeButton("DuplicateButton", "Duplicate", UDim2.new(0.5, -180, 0.9, 0), Color3.new(0, 0, 0))
local cancelBtn = makeButton("CancelButton", "Cancel Duplication", UDim2.new(0.5, 10, 0.9, 0), Color3.new(0.1, 0.1, 0.1))
cancelBtn.TextColor3 = Color3.new(1, 0, 0)
cancelBtn.Visible = false

-- Message Label
local msg = Instance.new("TextLabel", gui)
msg.Size = UDim2.new(0, 250, 0, 40)
msg.Position = UDim2.new(0.5, -125, 0.75, -25)
msg.BackgroundColor3 = Color3.new(0, 0, 0)
msg.TextColor3 = Color3.new(1, 1, 1)
msg.Font = Enum.Font.SourceSansBold
msg.TextSize = 20
msg.Text = ""
msg.Visible = false

-- Folders
local clonesFolder = workspace:FindFirstChild("VisualPetClones") or Instance.new("Folder", workspace)
clonesFolder.Name = "VisualPetClones"

local fakeInventory = player:FindFirstChild("FakeInventory") or Instance.new("Folder", player)
fakeInventory.Name = "FakeInventory"

-- Duplication Logic
local dupThread
local cancelled = false

local function getHeldPet()
    local char = player.Character or player.CharacterAdded:Wait()
    local tool = char:FindFirstChildOfClass("Tool")
    if not tool then return end
    local pet = tool:FindFirstChildWhichIsA("Model") or tool:FindFirstChild("Pet")
    return pet
end

local function duplicateHeldPet()
    local pet = getHeldPet()
    if not pet then warn("❌ No pet held"); return end

    cancelled = false
    msg.Text = "Duping in 3 minutes..."
    msg.Visible = true
    cancelBtn.Visible = true

    dupThread = task.delay(180, function()
        if cancelled then return end
        msg.Visible = false
        cancelBtn.Visible = false

        local clone = pet:Clone()
        clone.Name = pet.Name .. "_Clone"

        local primary = clone:FindFirstChildWhichIsA("BasePart")
        if primary then
            clone.PrimaryPart = primary
            clone:SetPrimaryPartCFrame(player.Character.PrimaryPart.CFrame * CFrame.new(3, 0, 0))
        end

        -- Copy data
        for _, attr in ipairs({"Age", "Weight"}) do
            local val = pet:FindFirstChild(attr)
            if val then val:Clone().Parent = clone end
        end

        clone.Parent = clonesFolder
        fakeInventory:ClearAllChildren()
        clone:Clone().Parent = fakeInventory

        print("✅ Visual pet clone created.")
    end)
end

local function cancelDuplication()
    cancelled = true
    msg.Visible = false
    cancelBtn.Visible = false
    dupThread = nil
    print("❌ Duplication canceled.")
end

dupeBtn.MouseButton1Click:Connect(duplicateHeldPet)
cancelBtn.MouseButton1Click:Connect(cancelDuplication)
